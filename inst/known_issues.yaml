known_issues:
  - backend: HDF5AnnData
    slot:
      - X
      - layers
      - obsp
      - varp
      - obsm
      - varm
    dtype:
      - integer_csparse
      - integer_rsparse
      - integer_matrix
    process: [read]
    error_message: |
      Failure (test-roundtrip-obspvarp.R:111:5): Writing an AnnData with obsp and varp 'integer_csparse' works
      a$dtype (`actual`) not equal to b$dtype (`expected`).

      `class(actual)`:   "numpy.dtypes.Float64DType" "numpy.dtype" "python.builtin.object"
      `class(expected)`: "numpy.dtypes.Int64DType"   "numpy.dtype" "python.builtin.object"
    description: Integers are being converted to floats.
    proposed_solution: Debug and fix
    to_investigate: True
    to_fix: True
  - backend: HDF5AnnData
    slot:
      - obsm
      - varm
    dtype:
      - boolean_array
      - categorical
      - categorical_missing_values
      - categorical_ordered
      - categorical_ordered_missing_values
      - dense_array
      - integer_array
      - nullable_boolean_array
      - nullable_integer_array
      - string_array
    process: [reticulate]
    error_message: |
      adata_r$varm[[name]] (`actual`) not equal to py_to_r(py_get_item(adata_py$varm, name)) (`expected`).

      `dim(actual)` is absent
      `dim(expected)` is an integer vector (20)
    description: Python nd.arrays have a dimension while R vectors do not.
    proposed_solution: Debug and fix
    to_investigate: True
    to_fix: True
  - backend: HDF5AnnData
    slot:
      - obsm
      - varm
    dtype:
      - boolean_array
      - categorical
      - categorical_missing_values
      - categorical_ordered
      - categorical_ordered_missing_values
      - dense_array
      - integer_array
      - nullable_boolean_array
      - nullable_integer_array
      - string_array
    process: [write]
    error_message: |
      Error in `if (found_dim != expected_dim) {
          stop("dim(", label, ")[", i, "] should have shape: ", expected_dim, 
              ", found: ", found_dim, ".")
      }`: argument is of length zero
    description: R vectors don't have a dimension.
    proposed_solution: The input checking function for obsm and varm should allow the object to be a vector of the correct length instead of only a matrix or a data frame.
    to_investigate: True
    to_fix: True
  - backend: to_SCE
    slot:
      - obsp
      - varp
    dtype:
      - numeric_csparse_with_nas
      - numeric_rsparse_with_nas
      - integer_csparse_with_nas
      - integer_rsparse_with_nas
    process: [convert]
    error_message: |
      `sce_matrix` (`actual`) not equal to `ad_matrix` (`expected`).

      actual vs expected
                      [, 1] [, 2] [, 3] [, 4] [, 5] [, 6] [, 7] [, 8] [, 9] [,10]
        actual[1, ]       NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
      - actual[2, ]       NA    NA    NA    NA   1.2    NA    NA    NA    NA    NA
      + expected[2, ]   0.00     0     0     0   1.2     0  0.00     0     0     0
        actual[3, ]       NA    NA    NA    NA    NA    NA    NA    NA    NA    NA
      - actual[4, ]     0.48    NA    NA    NA    NA    NA  0.66    NA    NA    NA
      + expected[4, ]   0.48     0     0     0   0.0     0  0.66     0     0     0
    description: After conversion of a sparse matrix, also containing NAs to a SelfHits object, the distinction between NA and 0 is lost.
    proposed_solution: Upstream the issue, is this intentional?
    to_investigate: True
    to_fix: False
  - backend: to_SCE
    slot:
      - obsp
      - varp
    dtype:
      - numeric_dense_with_nas
      - numeric_matrix_with_nas
    process: [convert]
    error_message: |
      `sce_matrix` (`actual`) not equal to `ad_matrix` (`expected`).

      actual vs expected
                            [, 1]     [, 2]     [, 3]     [, 4]     [, 5]     [, 6]      [, 7]     [, 8]     [, 9]     [,10]
      - actual[1, ]    0.00000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000000 0.0000000 0.0000000 0.0000000
      + expected[1, ]          NA        NA        NA        NA        NA        NA         NA        NA        NA        NA
        actual[2, ]    0.30879331 0.3489866 0.9774142 0.5004646 0.5611313 0.8525832 0.06551198 0.1663290 0.1574261 0.4143122
      - actual[3, ]    0.00000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000000 0.0000000 0.0000000 0.0000000
      + expected[3, ]          NA        NA        NA        NA        NA        NA         NA        NA        NA        NA
    description: After conversion of a sparse matrix, also containing NAs to a SelfHits object, the distinction between NA and 0 is lost.
    proposed_solution: Upstream the issue, is this intentional?
    to_investigate: True
    to_fix: False
